Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2020-01-22T14:53:51+03:00

====== Управление репозиториями Ubuntu ======
Создан Среда 22 Январь 2020

===== Устранение ошибок обновления системы =====
Если при выполнении команды
{{{code: lang="sh" linenumbers="False"
$ sudo update
}}}

отображаются ошибки вида:

	''Следующие подписи не могут быть проверены, так как недоступен открытый ключ: NO_PUBKEY 76F1A20FF987672F''

, необходимо запомнить значение NO_PUBKEY (в данном примере оно соответствует значению E9372975FC15D0BB) и подставить это значение в команду
{{{code: lang="sh" linenumbers="False"
$ sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys
}}}

то есть нужно просто выполнить команду:
{{{code: lang="sh" linenumbers="False"
$ sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E9372975FC15D0BB
}}}

Снова запустим:
sudo apt-get update
Если всё сделано правильно, ошибок быть не должно.

===== Репозиторий не содержит файла Release =====

Файл Release - один из самых важных файлов для работы репозитория в Ubuntu. Когда утилита apt обновляет список пакетов, она открывает адрес репозитория и пытается прочитать файл Release. В нем содержится основная информация о репозитории, а также адреса файлов packages.gz, в которых находятся списки пакетов, ссылки где их можно найти и контрольные суммы. Если этого файла нет, то репозиторий подключить невозможно.

Причин этому может быть несколько. Либо репозиторий заброшен и больше не развивается, либо вы его неправильно настроили. В терминале эти ошибки обычно не мешают, а вот при попытке обновления через графический интерфейс могут возникнуть проблемы.

==== НЕТ ВЕТКИ РЕПОЗИТОРИЯ ДЛЯ ВАШЕЙ ВЕРСИИ UBUNTU ====
Сначала убедитесь, что вы используете правильные репозитории для своего дистрибутива. Например, утилита apt-add-repository при добавлении PPA репозитория добавляет к его адресу кодовое имя дистрибутива. У репозитория нет отдельной ветки для вашей системы, то он не сможет быть добавлен. Нужно вручную указать то, кодовое имя, для которого есть ветка.

Зайдите на страницу этого PPA репозитория на Launchpad и проверьте есть ли версия для вашего дистрибутива. Если в PPA нет версии для используемого дистрибутива, то можно 
или в каталоге [[/etc/apt/sources.list.d]] найти файл <имя_репозитория>-<кодовое_имя_дистрибутива> или в файле [[/etc/apt/sources.list]]  найти строку с указанием ppa репозитория в строке вида
deb <url_ppa_repositoty> <кодовое_имя_дистрибутива> main
заменить кодовое имя дистрибутива на то, которое есть в ppa репозитории

===== Репозитории apt в Ubuntu =====

При установке пакетов в Ubuntu они загружаются из одного или нескольких репозиториев apt. Хранилище apt – это сетевой сервер или локальный каталог, содержащий пакеты deb и файлы метаданных, которые доступны для чтения инструментам apt. Хотя в репозиториях Ubuntu по умолчанию доступны тысячи приложений, иногда может потребоваться установить программное обеспечение из стороннего репозитория.

В Ubuntu и всех других дистрибутивах на основе Debian программные репозитории apt определяются в файле /etc/apt/sources.list или в отдельных файлах в каталоге /etc/apt/sources.list.d

Имена файлов репозитория внутри каталога /etc/apt/sources.list.d/ должны заканчиваться на .list.

Общий синтаксис файла /etc/apt/sources.list принимает следующий формат:

	''deb http://repo.tld/ubuntu distro component...''

Первая запись в строке определяет тип архива. Тип архива может быть как deb, так и deb-src. deb подразумевает, что репозиторий содержит .deb пакеты, а deb-src подразумевает пакеты с исходным кодом.
Вторая запись – это URL хранилища.
Третья запись указывает кодовое имя дистрибутива, например beaver, xenial и так далее.
Последние записи являются компонентами или категориями репозитория. Репозитории Ubuntu по умолчанию разделены на четыре компонента – основной, ограниченный, юниверс и мультиверс. Как правило, сторонние репозитории имеют только одну категорию.

Формат файлов в каталоге  /etc/apt/sources.list.d/ такой же, как и для обычного файла sources.list.

Большинство репозиториев предоставляют открытый ключ для аутентификации загруженных пакетов, которые необходимо загрузить и импортировать.

==== Установка add-apt-repository ====
add-apt-repository - скрипт Python, который позволяет добавить apt-репозиторий в отдельный файл в каталоге /etc/apt/sources.list.d. Команду также можно использовать для удаления уже существующего хранилища. 

Если скрипт  add-apt-repository отсутствует в системе необходимо установить пакет software-properties-common

{{{code: lang="sh" linenumbers="False"
$ sudo apt update
$ sudo apt install software-properties-common
}}}


==== Добавление репозиториев с add-apt-repository ====
Основной синтаксис команды add-apt-repository следующий:

{{{code: lang="sh" linenumbers="False"
add-apt-repository [options] repository
}}}

, где repository может быть либо обычная запись apt-репозитория, которую можно добавить к файлу  /etc/apt/sources.list, например, deb http://repo.tld/ubuntu distro component,  либо ppa-репозиторий в формате ppa:<user>/<ppa-name>.

По умолчанию в Ubuntu 18.04 и новее add-apt-repository  также обновляет индекс пакета, если импортирован открытый ключ репозитория.

Индекс пакетов – это база данных, которая содержит записи доступных пакетов из репозиториев, включенных в системе.

==== Добавление репозиториев PPA ====
Персональные архивы пакетов (PPA, personal packet archive) – это сервис, который позволяет пользователям загружать исходные пакеты Ubuntu, созданные и опубликованные с помощью Launchpad, в качестве подходящего хранилища.

При добавлении репозитория PPA, команда add-apt-repository создает новый файл в каталоге /etc/apt/sources.list.d

==== Добавление репозиториев вручную ====
Если вы хотите лучше контролировать организацию ваших источников, вы можете вручную отредактировать файл /etc/apt/sources.list и добавить в него строку хранилища apt.

deb <url_хранилища> <кодовое_имя_дистрибутива> <категория_репозитория>

Узнать  кодовое имя дистрибутива можно с помощью команды

{{{code: lang="sh" linenumbers="False"
$ lsb_release -cs
# или
$ cat /etc/os-release
}}}

Другой вариант – создать новый файл репозитория в каталоге /etc/apt/sources.list.d/.

==== Импортирт открытого ключа хранилища ====
При ручной настройке хранилища необходимо вручную импортировать открытый ключ хранилища в систему. Для этого можно использовать либо wget или curl:


==== Добавление  публичного GnuPG-ключа репозитория в базу apt ====
При установке пакетов в Ubuntu Linux, например, с помощью команды apt-get иногда возникает ошибка вида «W: GPG error: [..] Release: The following signatures couldn’t be verified because the public key is not available: NO_PUBKEY [..]». Обычно такая ситуация возникает после добавления нового репозитория в /etc/apt/sources.list с последующей попыткой установить пакет из этого репозитория.

Причина происхождения проблемы — отсутствие в системе публичного GnuPG-ключа репозитория, из которого инсталлируется пакет (который, в свою очередь, подписан данным ключом). Хеш нужного ключа указывается в тексте ошибки после NO_PUBKEY (т.е. на месте второго «[..]»). Именно его и надо добавить в базу apt системы для успешной установки пакета.

Чтобы это сделать, требуется выполнить команды:

gpg --keyserver subkeys.pgp.net --recv KEY
gpg --export --armor KEY | sudo apt-key add -
или
sudo apt-key adv --recv-keys --keyserver keyserver.ubuntu.com KEY

Здесь вместо KEY нужно подставить значение того GPG-ключа, который необходимо добавить в свою базу. Так, например, если вы получали ошибку NO_PUBKEY F120156012B83718, вам потребуется выполнить следующие команды:

gpg --keyserver subkeys.pgp.net --recv F120156012B83718
gpg --export --armor F120156012B83718 | sudo apt-key add -
После успешного экспорта GPG-ключа в базу вы можно повторить попытку установить требуемый пакет.

